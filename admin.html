<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeatroWeb - Administración</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Font Awesome para íconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>

    <div id="toast-container"></div>

    <header>
        <nav id="main-nav"></nav>
    </header>

    <main class="container admin-container">
        <h1>Panel de Administración</h1>

        <!-- Mensaje de estado de autenticación del administrador -->
        <div id="auth-status-message" class="info-message">Cargando estado de autenticación...</div>
        <div id="admin-user-id" class="user-id-display"></div>
        <button id="sign-out-btn" class="btn btn-primary btn-logout" style="display: none;">Cerrar Sesión</button>

        <!-- Pestañas de Navegación -->
        <div class="admin-tabs">
            <button id="tab-events" class="tab-button active" data-tab="events">Gestión de Eventos</button>
            <button id="tab-users" class="tab-button" data-tab="users">Gestión de Usuarios</button>
            <button id="tab-statistics" class="tab-button" data-tab="statistics">Estadísticas/Analíticas</button>
        </div>

        <!-- Contenido de la Pestaña de Gestión de Eventos -->
        <section id="events-tab-content" class="admin-tab-content active">
            <div class="admin-card">
                <h2>Gestión de Eventos</h2>
                <p class="form-description">Aquí puedes agregar, editar y eliminar eventos. Recuerda que al eliminar un evento se eliminarán también sus asientos y compras asociadas.</p>
                <form id="event-form" class="admin-form">
                    <input type="hidden" id="event-id">

                    <div class="input-group-admin">
                        <label for="event-titulo" class="form-label">Título del Evento:</label>
                        <input type="text" id="event-titulo" class="input-field-admin" required disabled>
                        <button type="button" class="btn-edit-field"><i class="fas fa-edit"></i></button>
                    </div>

                    <div class="input-group-admin">
                        <label for="event-genero" class="form-label">Género:</label>
                        <input type="text" id="event-genero" class="input-field-admin" required disabled>
                        <button type="button" class="btn-edit-field"><i class="fas fa-edit"></i></button>
                    </div>
                    
                    <div class="input-group-admin">
                        <label for="event-lugar" class="form-label">Lugar:</label>
                        <input type="text" id="event-lugar" class="input-field-admin" required disabled>
                        <button type="button" class="btn-edit-field"><i class="fas fa-edit"></i></button>
                    </div>

                    <div class="input-group-admin">
                        <label for="event-fecha" class="form-label">Fecha y Hora:</label>
                        <input type="datetime-local" id="event-fecha" class="input-field-admin" required disabled>
                        <button type="button" class="btn-edit-field"><i class="fas fa-edit"></i></button>
                    </div>
                    
                    <div class="input-group-admin">
                        <label for="event-precio" class="form-label">Precio de Entrada (CLP$):</label>
                        <input type="number" id="event-precio" class="input-field-admin" required min="0" step="1000" disabled>
                        <button type="button" class="btn-edit-field"><i class="fas fa-edit"></i></button>
                    </div>

                    <div class="input-group-admin">
                        <label for="event-imagen-url" class="form-label">URL Imagen:</label>
                        <input type="text" id="event-imagen-url" class="input-field-admin" placeholder="URL de la imagen del evento" required disabled>
                        <button type="button" class="btn-edit-field"><i class="fas fa-edit"></i></button>
                    </div>
                    <div class="image-preview-admin">
                        <p class="form-label">Previsualización de Imagen:</p>
                        <div id="event-image-preview" class="image-placeholder-box">
                            <img src="" alt="Previsualización de imagen" style="display: none;">
                            <span class="text-placeholder">Sin imagen</span>
                        </div>
                    </div>


                    <div class="input-group-admin textarea-group">
                        <label for="event-descripcion" class="form-label">Descripción:</label>
                        <textarea id="event-descripcion" class="input-field-admin" rows="5" required disabled></textarea>
                        <button type="button" class="btn-edit-field"><i class="fas fa-edit"></i></button>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-cancel" id="cancel-edit-btn">Cancelar / Nuevo</button>
                        <button type="submit" class="btn btn-primary" id="save-event-btn">Guardar Evento</button>
                    </div>
                </form>
            </div>

            <div class="admin-card" style="margin-top: 30px;">
                <h2>Listado de Eventos</h2>
                <div class="table-responsive">
                    <table id="admin-event-table">
                        <thead>
                            <tr>
                                <th data-sort="titulo">Título <i class="fas fa-sort sort-icon"></i></th>
                                <th data-sort="genero">Género <i class="fas fa-sort sort-icon"></i></th>
                                <th data-sort="lugar">Lugar <i class="fas fa-sort sort-icon"></i></th>
                                <th data-sort="fecha">Fecha <i class="fas fa-sort sort-icon"></i></th>
                                <th data-sort="precio">Precio <i class="fas fa-sort sort-icon"></i></th>
                                <th>Imagen</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="admin-event-table-body">
                            <!-- Eventos se cargarán aquí -->
                        </tbody>
                    </table>
                    <p id="no-filtered-events-message" class="info-message" style="display:none; text-align: center; margin-top: 20px;">No se encontraron eventos que coincidan con la búsqueda o filtro.</p>
                </div>
            </div>
        </section>

        <!-- Contenido de la Pestaña de Gestión de Usuarios -->
        <section id="users-tab-content" class="admin-tab-content">
            <div class="admin-card">
                <h2>Gestión de Usuarios</h2>
                <p class="form-description">Administra los usuarios registrados en tu plataforma. Puedes ver sus datos y realizar acciones.</p>
                <div class="table-responsive">
                    <table id="admin-user-table">
                        <thead>
                            <tr>
                                <th data-sort="email">Email <i class="fas fa-sort sort-icon"></i></th>
                                <th data-sort="id">UID <i class="fas fa-sort sort-icon"></i></th>
                                <th data-sort="name">Nombre <i class="fas fa-sort sort-icon"></i></th>
                                <th data-sort="registeredAt">Fecha Registro <i class="fas fa-sort sort-icon"></i></th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="admin-user-table-body">
                            <!-- Usuarios se cargarán aquí -->
                        </tbody>
                    </table>
                    <p id="no-filtered-users-message" class="info-message" style="display:none; text-align: center; margin-top: 20px;">No se encontraron usuarios que coincidan con la búsqueda o filtro.</p>
                </div>
            </div>
        </section>

        <!-- Contenido de la Pestaña de Estadísticas/Analíticas -->
        <section id="statistics-tab-content" class="admin-tab-content">
            <div class="admin-card">
                <h2>Estadísticas Generales</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-calendar-alt icon-large"></i>
                        <p class="stat-label">Total de Eventos</p>
                        <p class="stat-value" id="stat-total-events">Cargando...</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-users icon-large"></i>
                        <p class="stat-label">Total de Usuarios Registrados</p>
                        <p class="stat-value" id="stat-total-users">Cargando...</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-ticket-alt icon-large"></i>
                        <p class="stat-label">Total de Entradas Vendidas</p>
                        <p class="stat-value" id="stat-tickets-sold">Cargando...</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-dollar-sign icon-large"></i>
                        <p class="stat-label">Ingresos Totales Estimados</p>
                        <p class="stat-value" id="stat-total-revenue">Cargando...</p>
                    </div>
                </div>
            </div>

            <div class="admin-card" style="margin-top: 30px;">
                <h2>Eventos con Más Ventas</h2>
                <div class="table-responsive">
                    <table id="stat-top-events-table">
                        <thead>
                            <tr>
                                <th>Evento</th>
                                <th>Entradas Vendidas</th>
                                <th>Ingresos Generados</th>
                            </tr>
                        </thead>
                        <tbody id="stat-top-events-table-body">
                            <!-- Top eventos se cargarán aquí -->
                        </tbody>
                    </table>
                    <p id="no-top-events-message" class="info-message" style="display:none; text-align: center; margin-top: 20px;">No hay ventas registradas aún.</p>
                </div>
            </div>
        </section>

        <!-- Modal de justificación de cambio de precio -->
        <div id="price-justification-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>Justificación de Cambio de Precio</h3>
                <p>Por favor, explica por qué estás cambiando el precio de este evento. Esta acción será registrada.</p>
                <textarea id="justification-textarea" rows="4" placeholder="Introduce tu justificación aquí..." required></textarea>
                <div class="modal-actions">
                    <button id="submit-justification-btn" class="btn btn-primary">Enviar Justificación</button>
                    <button id="cancel-justification-btn" class="btn btn-cancel">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal de edición de usuario -->
        <div id="edit-user-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>Editar Usuario</h3>
                <form id="edit-user-form">
                    <input type="hidden" id="edit-user-id">
                    <div class="form-group">
                        <label for="edit-user-name">Nombre:</label>
                        <input type="text" id="edit-user-name" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-user-email">Correo Electrónico:</label>
                        <input type="email" id="edit-user-email" disabled>
                        <small>El email no se puede cambiar desde aquí.</small>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                        <button type="button" id="cancel-edit-user-btn" class="btn btn-secondary">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal de mensaje genérico (para errores, confirmaciones, etc.) -->
        <div id="generic-message-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3 id="modal-title"></h3>
                <p id="modal-message"></p>
                <div class="modal-actions">
                    <button id="modal-close-btn" class="btn btn-primary">Aceptar</button>
                </div>
            </div>
        </div>

        <!-- Mensaje flotante (Toast) -->
        <div id="message-box" class="message-box invisible">
            <span></span>
        </div>

    </main>

    <footer>
        <p>&copy; 2025 TeatroWeb. Todos los derechos reservados.</p>
    </footer>

    <!-- Scripts modulares al final del body -->
    <script type="module" src="js/firebase-init.js"></script>
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/nav.js"></script>
    <script type="module" src="js/admin.js"></script>
</body>
</html>
